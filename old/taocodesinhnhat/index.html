<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>T·∫°o Web | TD Web</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }

    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.2),
        0 0 100px rgba(255, 255, 255, 0.2);
      text-align: center;
      position: relative;
      z-index: 10;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      animation: slideIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      max-width: 450px;
      width: 90%;
    }

    h2 {
      background: linear-gradient(45deg, #1a2a6c, #b21f1f);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-size: 2.5em;
      margin-bottom: 30px;
      font-weight: 700;
      letter-spacing: 1px;
    }

    input {
      padding: 15px 20px;
      border: 2px solid transparent;
      border-radius: 12px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      outline: none;
      width: 100%;
      font-family: 'Montserrat', sans-serif;
    }

    input:focus {
      border-color: #1a2a6c;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(26, 42, 108, 0.2);
    }

    button {
      padding: 15px 30px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      color: white;
      background: linear-gradient(45deg, #1a2a6c, #b21f1f);
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      position: relative;
      overflow: hidden;
      width: 100%;
      margin-top: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(26, 42, 108, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    .input-group {
      position: relative;
      margin-bottom: 20px;
    }

    .input-group label {
      position: absolute;
      left: 15px;
      top: -10px;
      background: white;
      padding: 0 5px;
      font-size: 12px;
      color: #1a2a6c;
      font-weight: 600;
    }

    .decoration {
      filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0) rotate(0deg); }
      33% { transform: translate(30px, -30px) rotate(120deg); }
      66% { transform: translate(-20px, 20px) rotate(240deg); }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    @keyframes sparkle {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-30px) scale(0); }
    }

    @media (max-width: 480px) {
      h2 {
        font-size: 2em;
      }

      .container {
        padding: 40px 30px;
      }
    }

    .date-wrapper {
      position: relative;
      display: flex;
      gap: 10px;
    }

    .calendar-toggle {
      background: linear-gradient(45deg, #1a2a6c, #b21f1f);
      color: white;
      border: none;
      border-radius: 12px;
      width: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .calendar-toggle:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(26, 42, 108, 0.2);
    }

    .date-picker {
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      z-index: 1000;
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      padding: 15px;
      display: none;
    }

    .date-picker.active {
      display: block;
      animation: fadeIn 0.2s ease-out;
    }

    .date-picker table {
      border-collapse: collapse;
      width: 100%;
    }

    .date-picker th, .date-picker td {
      padding: 8px;
      text-align: center;
    }

    .date-picker td {
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.2s;
    }

    .date-picker td:hover {
      background: rgba(26, 42, 108, 0.1);
    }

    .date-picker td.selected {
      background: linear-gradient(45deg, #1a2a6c, #b21f1f);
      color: white;
    }

    .date-picker th button {
      padding: 5px 10px;
      margin: 0 5px;
      background: transparent;
      color: #1a2a6c;
      border: none;
      cursor: pointer;
    }

    .year-selector {
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      border-radius: 12px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      padding: 10px;
      display: none;
      max-height: 200px;
      overflow-y: auto;
      width: 100px;
      z-index: 1001;
    }

    .year-selector.active {
      display: block;
    }

    .year-selector div {
      padding: 5px;
      cursor: pointer;
      text-align: center;
    }

    .year-selector div:hover {
      background: rgba(26, 42, 108, 0.1);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .return-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      color: white;
      font-size: 18px;
      background: linear-gradient(45deg, #1a2a6c, #b21f1f);
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      z-index: 100;
      text-decoration: none;
      transition: all 0.3s ease;
      font-family: 'Montserrat', sans-serif;
    }

    .return-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(26, 42, 108, 0.4);
    }
  </style>
</head>
<body>
  <a href="../index.html" class="return-btn">‚Üê Trang ch·ªß</a>
  <div class="container">
    <h2><span class="emoji">üéÇ</span> T·∫°o Thi·ªáp Sinh Nh·∫≠t <span class="emoji">üéâ</span></h2>
    <form onsubmit="goToBirthday(event)">
      <div class="input-group">
        <label for="name">T√™n ng∆∞·ªùi nh·∫≠n</label>
        <input type="text" id="name" placeholder="Nh·∫≠p t√™n ng∆∞·ªùi b·∫°n mu·ªën g·ª≠i..." required />
      </div>
      <div class="input-group">
        <label for="dob">Ng√†y sinh</label>
        <div class="date-wrapper">
          <input type="text" 
                 id="dob" 
                 required 
                 placeholder="DD/MM/YYYY"
                 maxlength="10"
                 onkeyup="formatDateInput(this)"
                 onblur="validateDate(this)" />
          <button type="button" class="calendar-toggle" onclick="toggleCalendar()">üìÖ</button>
          <div class="date-picker" id="datePicker"></div>
        </div>
      </div>
      <button type="submit">
        <span>T·∫°o thi·ªáp ngay</span>
      </button>
    </form>
  </div>

  <script>
    function formatDateInput(input) {
      let value = input.value.replace(/\D/g, '');
      if (value.length > 0) {
        if (value.length <= 2) {
          input.value = value;
        } else if (value.length <= 4) {
          input.value = value.slice(0, 2) + '/' + value.slice(2);
        } else {
          input.value = value.slice(0, 2) + '/' + value.slice(2, 4) + '/' + value.slice(4, 8);
        }
      }
    }

    function validateDate(input) {
      const parts = input.value.split('/');
      if (parts.length === 3) {
        const day = parseInt(parts[0]);
        const month = parseInt(parts[1]);
        const year = parseInt(parts[2]);
        const date = new Date(year, month - 1, day);
        
        if (date && date.getDate() === day && date.getMonth() === month - 1 && date.getFullYear() === year) {
          return;
        }
      }
      alert('Vui l√≤ng nh·∫≠p ng√†y h·ª£p l·ªá theo ƒë·ªãnh d·∫°ng DD/MM/YYYY');
      input.value = '';
    }

    function goToBirthday(e) {
      e.preventDefault();
      try {
        const name = document.getElementById('name').value.trim();
        const dobInput = document.getElementById('dob');
        const dobParts = dobInput.value.split('/');
        
        if (!name || dobParts.length !== 3) {
          alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
          return;
        }

        // Convert DD/MM/YYYY to YYYY-MM-DD for storage
        const formattedDate = `${dobParts[2]}-${dobParts[1]}-${dobParts[0]}`;
        const str = `${name},${formattedDate}`;
        const encoded = btoa(encodeURIComponent(str));
        window.location.href = `birthday.html?data=${encoded}`;
      } catch (error) {
        console.error('Error:', error);
        alert('C√≥ l·ªói x·∫£y ra, vui l√≤ng th·ª≠ l·∫°i!');
      }
    }

    // Optimize sparkle effect with throttling
    let lastSparkle = 0;
    document.addEventListener('mousemove', (e) => {
      const now = Date.now();
      if (now - lastSparkle > 50 && Math.random() > 0.98) {
        lastSparkle = now;
        createSparkle(e.clientX, e.clientY);
      }
    });

    function createSparkle(x, y) {
      const sparkle = document.createElement('div');
      sparkle.style.position = 'fixed';
      sparkle.style.left = x + 'px';
      sparkle.style.top = y + 'px';
      sparkle.style.pointerEvents = 'none';
      sparkle.style.fontSize = '20px';
      sparkle.style.animation = 'sparkle 1s ease-out forwards';
      sparkle.textContent = '‚ú®';
      document.body.appendChild(sparkle);

      sparkle.addEventListener('animationend', () => sparkle.remove());
    }

    const style = document.createElement('style');
    style.textContent = `
      @keyframes sparkle {
        0% { opacity: 1; transform: translateY(0) scale(1); }
        100% { opacity: 0; transform: translateY(-30px) scale(0); }
      }
    `;
    document.head.appendChild(style);

    function toggleCalendar() {
      const picker = document.getElementById('datePicker');
      if (!picker.classList.contains('active')) {
        showCalendar();
      } else {
        picker.classList.remove('active');
      }
    }

    function showCalendar() {
      const picker = document.getElementById('datePicker');
      const input = document.getElementById('dob');
      const today = new Date();
      
      let currentMonth = today.getMonth();
      let currentYear = today.getFullYear();
      
      // Parse existing date if any
      if (input.value) {
        const [day, month, year] = input.value.split('/');
        if (day && month && year) {
          currentMonth = parseInt(month) - 1;
          currentYear = parseInt(year);
        }
      }
      
      renderCalendar(currentMonth, currentYear);
      picker.classList.add('active');
      
      // Close calendar when clicking outside
      document.addEventListener('click', closeCalendarOnClickOutside);
    }

    function closeCalendarOnClickOutside(e) {
      const picker = document.getElementById('datePicker');
      const toggle = document.querySelector('.calendar-toggle');
      if (!picker.contains(e.target) && !toggle.contains(e.target)) {
        picker.classList.remove('active');
        document.removeEventListener('click', closeCalendarOnClickOutside);
      }
    }

    function renderCalendar(month, year) {
      const picker = document.getElementById('datePicker');
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const firstDay = new Date(year, month, 1).getDay();
      
      let html = `
        <table>
          <tr>
            <th colspan="7">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <button type="button" onclick="changeMonth(-1, ${month}, ${year}); event.stopPropagation();">‚Üê</button>
                <div style="display: flex; gap: 5px; align-items: center;">
                  <span>${getMonthName(month)}</span>
                  <button type="button" onclick="toggleYearSelector(${year}); event.stopPropagation();">${year} ‚ñº</button>
                </div>
                <button type="button" onclick="changeMonth(1, ${month}, ${year}); event.stopPropagation();">‚Üí</button>
              </div>
            </th>
          </tr>
          <tr>
            <th>CN</th><th>T2</th><th>T3</th><th>T4</th>
            <th>T5</th><th>T6</th><th>T7</th>
          </tr>
          <tr>
      `;
      
      let day = 1;
      for (let i = 0; i < 42; i++) {
        if (i % 7 === 0 && i !== 0) html += '</tr><tr>';
        
        if (i < firstDay || day > daysInMonth) {
          html += '<td></td>';
        } else {
          html += `<td onclick="selectDate(${day}, ${month + 1}, ${year}); event.stopPropagation();">${day}</td>`;
          day++;
        }
      }
      
      html += '</tr></table>';
      html += '<div id="yearSelector" class="year-selector"></div>';
      picker.innerHTML = html;
    }

    function getMonthName(month) {
      const months = ['Th√°ng 1', 'Th√°ng 2', 'Th√°ng 3', 'Th√°ng 4', 'Th√°ng 5', 'Th√°ng 6',
                     'Th√°ng 7', 'Th√°ng 8', 'Th√°ng 9', 'Th√°ng 10', 'Th√°ng 11', 'Th√°ng 12'];
      return months[month];
    }

    function changeMonth(change, month, year) {
      event.preventDefault(); // Prevent form submission
      month += change;
      if (month < 0) {
        month = 11;
        year--;
      } else if (month > 11) {
        month = 0;
        year++;
      }
      renderCalendar(month, year);
      
      // Keep the calendar open
      const picker = document.getElementById('datePicker');
      picker.classList.add('active');
    }

    function selectDate(day, month, year) {
      const input = document.getElementById('dob');
      input.value = `${String(day).padStart(2, '0')}/${String(month).padStart(2, '0')}/${year}`;
      document.getElementById('datePicker').classList.remove('active');
      validateDate(input);
    }

    function toggleYearSelector(currentYear) {
      const yearSelector = document.getElementById('yearSelector');
      if (yearSelector.classList.contains('active')) {
        yearSelector.classList.remove('active');
        return;
      }

      let html = '';
      const startYear = currentYear - 50;
      const endYear = currentYear + 50;

      for (let year = startYear; year <= endYear; year++) {
        html += `<div onclick="selectYear(${year})">${year}</div>`;
      }

      yearSelector.innerHTML = html;
      yearSelector.classList.add('active');

      // Scroll to current year
      const currentYearElement = yearSelector.children[50];
      currentYearElement.scrollIntoView({ block: 'center' });
    }

    function selectYear(year) {
      const picker = document.getElementById('datePicker');
      const currentMonth = new Date().getMonth();
      renderCalendar(currentMonth, year);
      document.getElementById('yearSelector').classList.remove('active');
      event.stopPropagation();
    }
  </script>
</body>
</html>
